<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversor de Moedas</title>   
    <link rel="icon" type="image/x-icon" href="/imgs/favicon-32x32.png">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="container header-container">
            <h1>Conversor de Moedas</h1>
            <button id="toggleMode" aria-label="Alternar modo claro/escuro">ðŸŒ™</button>
        </div>
    </header>

    <main>
        <div class="converter card">
            <form id="currencyForm">
                <label for="fromCurrency">De:</label>
                <select id="fromCurrency"></select>

                <button type="button" id="swap" title="Inverter moedas">â‡…</button>

                <label for="toCurrency">Para:</label>
                <select id="toCurrency"></select>

                <label for="amount">Valor:</label>
                <input type="number" id="amount" placeholder="Insira o valor" required />

                <button type="submit" id="convertButton">Converter</button>
            </form>

            <p id="result"></p>
            <p id="lastUpdate"></p>

            <div class="rates">
                <p><strong>CotaÃ§Ã£o Atual</strong> (atualiza a cada 30s):</p>
                <p>DÃ³lar: <span id="usdRate">Carregando...</span></p>
                <p>Bitcoin: <span id="btcRate">Carregando...</span></p>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Conversor de Moedas. DEV Luck Noshi. Todos os direitos reservados.</p>
    </footer>

    <script src="script.js"></script>
    <script>
        const apiKey = 'b9a7dcaf23d976b7c810acc7';
        const apiUrl = `https://v6.exchangerate-api.com/v6/${apiKey}/latest/`;

        const selectFrom = document.getElementById("fromCurrency");
        const selectTo = document.getElementById("toCurrency");
        const result = document.getElementById("result");
        const lastUpdate = document.getElementById("lastUpdate");
        const usdRateSpan = document.getElementById("usdRate");
        const btcRateSpan = document.getElementById("btcRate");
        const form = document.getElementById("currencyForm");

        async function loadCurrencies() {
            try {
                const response = await fetch(`https://v6.exchangerate-api.com/v6/${apiKey}/codes`);
                const data = await response.json();
                if (data.result === "success") {
                    data.supported_codes.forEach(code => {
                        const option1 = new Option(`${code[1]} (${code[0]})`, code[0]);
                        const option2 = new Option(`${code[1]} (${code[0]})`, code[0]);
                        selectFrom.appendChild(option1);
                        selectTo.appendChild(option2);
                    });
                    selectFrom.value = "USD";
                    selectTo.value = "BRL";
                }
            } catch (error) {
                console.error("Erro ao carregar moedas", error);
            }
        }

        async function loadRates() {
            try {
                const response = await fetch(apiUrl + "USD");
                const data = await response.json();
                if (data.result === "success") {
                    usdRateSpan.innerText = data.conversion_rates.BRL.toFixed(2) + " BRL";
                }
            } catch (error) {
                usdRateSpan.innerText = "Erro";
            }
            try {
                const response = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd");
                const data = await response.json();
                if (data.bitcoin && data.bitcoin.usd) {
                    btcRateSpan.innerText = data.bitcoin.usd.toFixed(2) + " USD";
                }
            } catch (error) {
                btcRateSpan.innerText = "Erro";
            }
        }

        document.getElementById("swap").addEventListener("click", () => {
            const temp = selectFrom.value;
            selectFrom.value = selectTo.value;
            selectTo.value = temp;
        });

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            const fromCurrency = selectFrom.value;
            const toCurrency = selectTo.value;
            const amount = parseFloat(document.getElementById("amount").value);
            if (isNaN(amount) || amount <= 0) {
                result.innerText = "Por favor, insira um valor vÃ¡lido.";
                return;
            }
            try {
                const response = await fetch(apiUrl + fromCurrency);
                const data = await response.json();
                if (data.result === "success") {
                    const rate = data.conversion_rates[toCurrency];
                    if (rate) {
                        const convertedValue = (amount * rate).toFixed(2);
                        result.innerText = `${amount} ${fromCurrency} = ${convertedValue} ${toCurrency}`;
                        lastUpdate.innerText = `Ãšltima atualizaÃ§Ã£o: ${new Date(data.time_last_update_utc).toLocaleString()}`;
                        localStorage.setItem("lastConversion", JSON.stringify({ fromCurrency, toCurrency, amount, convertedValue }));
                    } else {
                        result.innerText = "Erro ao obter taxa de cÃ¢mbio.";
                    }
                } else {
                    result.innerText = "Erro na resposta da API.";
                }
            } catch (error) {
                result.innerText = "Erro na conexÃ£o com a API.";
                console.error(error);
            }
        });

        function loadLastConversion() {
            const lastConversion = localStorage.getItem("lastConversion");
            if (lastConversion) {
                const { fromCurrency, toCurrency, amount, convertedValue } = JSON.parse(lastConversion);
                selectFrom.value = fromCurrency;
                selectTo.value = toCurrency;
                document.getElementById("amount").value = amount;
                result.innerText = `${amount} ${fromCurrency} = ${convertedValue} ${toCurrency}`;
            }
        }

        loadCurrencies().then(() => {
            loadLastConversion();
            loadRates();
            setInterval(loadRates, 30000);
        });
    </script>
</body>
</html>
